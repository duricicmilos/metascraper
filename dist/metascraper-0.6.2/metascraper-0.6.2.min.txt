/*! Metascraper v0.6.2 | (c) Metascraper | MIT license */
if("undefined"==typeof jQuery)throw new Error("Metascraper requires jQuery");var meta={projectName:"Metascraper",version:"0.6.2",options:{webApiPrefix:"http://localhost/",UnauthRedir:"/app/login.htm",attrName:"data-value",attrMemberName:"data-member",attrArrayName:"data-array",attrTextName:"data-text",attrHrefName:"data-href",attrClickName:"data-click",attrTypeName:"data-type",attrClassName:"data-class",attrScrapeName:"data-scrape",indexName:"{{*index}}",tokenName:"{{*token}}",scrape:!0},loadTypesEnum:Object.freeze({Replace:0,BeforeBeginAppend:1,AfterBeginAppend:2,BeforeEndAppend:3,AfterEndAppend:4}),storeTypesEnum:Object.freeze({OneTimeSingleTab:0,OneTimeAllTab:1,SessionSingleTab:2,ForeverAllTab:4}),dataTypesEnum:Object.freeze({date:"date",time:"time",datetime:"datetime",string:"string",number:"number",json:"json"}),send:function(e){var t=meta.options.scrape;void 0!==e.scrape&&(t=e.scrape);var a=t?this.scrape(!0):{};e.data&&this.extend(a.data,e.data);var n={contentType:"application/json",dataType:"json",data:a};this.extend(n,e),-1==n.url.indexOf("://")&&(n.url=this.options.webApiPrefix+n.url),this.tokenize(n),this.ajax(n)},receive:function(e){var t=e.success,a={contentType:"application/json",dataType:"json"};this.extend(a,e),a.success=function(e,a,n){meta.bind(e),t&&t(e,a,n)};var n=a.url.indexOf("://");(-1===n||n>7)&&(a.url=this.options.webApiPrefix+a.url),this.tokenize(a),this.ajax(a)},token:function(){return window.localStorage.getItem(meta.options.tokenName)},tokenize:function(e){var t=meta.token();if(t){var a={Authorization:"Bearer "+t};e.headers||(e.headers={}),this.extend(e.headers,a)}},get:function(e){var t={method:"GET"};this.extend(t,e),this.receive(t)},post:function(e){var t={method:"POST"};this.extend(t,e),this.send(t)},put:function(e){var t={method:"PUT"};this.extend(t,e),this.send(t)},del:function(e){var t={method:"DELETE"};this.extend(t,e),this.send(t)},create:function(e){this.post(e)},read:function(e){this.get(e)},update:function(e){this.put(e)},login:function(e){var t=e.success,a={url:"Auth/Login"};this.extend(a,e),a.success=function(e,a,n){window.localStorage.setItem(meta.options.tokenName,e.token),t&&t(e,a,n)},this.post(a)},getValue:function(e){if(e instanceof HTMLInputElement)return"checkbox"===e.type?e.checked:e.value;if(e instanceof HTMLSelectElement){if(e.multiple){for(var t=[],a=e.selectedOptions,n=0;n<a.length;n++)t.push(a[n].value);return t}return e.value}return e.innerHTML},scrape:function(e){for(var t={},a=meta.options.attrName,n=this.selectAll("["+a+"]"),r=0;r<n.length;r++)if(!(n[r]instanceof HTMLTableElement||n[r]instanceof HTMLUListElement)){if(n[r].hasAttribute(meta.options.attrScrapeName))if(0==JSON.parse(n[r].getAttribute(meta.options.attrScrapeName)))continue;t[n[r].getAttribute(a)]=meta.getValue(n[r])}return e?JSON.stringify(t):t},formatValue:function(e,t){try{if(e.hasAttribute(meta.options.attrTypeName)){var a=e.getAttribute(meta.options.attrTypeName);a==meta.dataTypesEnum.string||(a==meta.dataTypesEnum.number?t=new Number(t):a==meta.dataTypesEnum.date||a==meta.dataTypesEnum.time||a==meta.dataTypesEnum.datetime?(t=new Date(t),a==meta.dataTypesEnum.date?t=t.toLocaleDateString():a==meta.dataTypesEnum.time?t=t.toLocaleTimeString():a==meta.dataTypesEnum.datetime&&(t=t.toLocaleString())):a==meta.dataTypesEnum.json&&(t=JSON.stringify(t)))}}catch(e){}return t},setValue:function(e,t){t=meta.formatValue(e,t),e instanceof HTMLSelectElement?e.value=t:e instanceof HTMLInputElement?"checkbox"===e.type?e.checked=t:e.value=t:e.innerHTML=t},paint:function(e){for(var t=meta.options.attrName,a=this.selectAll("["+t+"]"),n=0;n<a.length;n++){var r=null;if(a[n].hasAttribute(meta.options.attrMemberName)){var i=a[n].getAttribute(meta.options.attrMemberName);i&&e[i]&&(r=e[i][a[n].getAttribute(t)])}null!=r&&meta.setValue(a[n],r)}},fill:function(e,t){var a=e.getAttribute(meta.options.attrName);if(e instanceof HTMLSelectElement){if(!a||!e.hasAttribute(meta.options.attrTextName))return;for(var n=e.getAttribute(meta.options.attrTextName),r=e.getAttribute(meta.options.attrClassName),i=0;i<t.length;i++){var o=document.createElement("option");r&&r.length>0&&o.classList.add(r),o.value=t[i][a],o.text=meta.formatValue(e,t[i][n]),e.add(o,null)}}else if(e instanceof HTMLTableElement){var m=e.tHead;if(!m||!m.rows||0==m.rows.length)return;var s=m.rows[0].cells;if(!s||0==s.length)return;for(var l=meta.getElemAttr(m.rows[0],meta.options.attrHrefName),u=meta.getElemAttr(m.rows[0],meta.options.attrClickName),c=meta.getElemAttr(m.rows[0],meta.options.attrClassName),d=0;d<t.length;d++){var p=e.insertRow(-1);if(l&&l.length>0&&u&&u.length>0)throw"ERROR reported by "+meta.projectName+". Cannot apply "+meta.options.attrHrefName+" and "+meta.options.attrClickName+" to a tr element.";if(l&&l.length>0){var f=a.length>0?l.replace(meta.options.indexName,t[d][a]):l;p.setAttribute("onclick","location.href = '"+f+"'")}if(u&&u.length>0){var h=a.length>0?u.replace(meta.options.indexName,t[d][a]):u;p.setAttribute("onclick",h)}c&&c.length>0&&p.classList.add(c);for(var g=0;g<s.length;g++){var T=p.insertCell(-1);if(s[g].hasAttribute(meta.options.attrTextName)){var A=meta.getElemAttr(s[g],meta.options.attrHrefName),v=meta.getElemAttr(s[g],meta.options.attrClickName),N=s[g].getAttribute(meta.options.attrTextName),E=meta.getElemAttr(s[g],meta.options.attrClassName);if(E&&E.length>0&&T.classList.add(E),void 0!==t[d][N]){var y=meta.formatValue(s[g],t[d][N]);if(A&&A.length>0){var b=document.createElement("a"),x=document.createTextNode(y);b.appendChild(x),v&&v.length>0&&b.setAttribute("onclick",v.replace(meta.options.indexName,t[d][a])),b.href=A.replace(meta.options.indexName,t[d][a]),T.innerHTML=b.outerHTML}else T.innerHTML=y,v&&v.length>0&&T.setAttribute("onclick",v.replace(meta.options.indexName,t[d][a]))}}}}}else if(e instanceof HTMLUListElement){var L=meta.getElemAttr(e,meta.options.attrTextName);if(!L)return;for(var H=meta.getElemAttr(e,meta.options.attrHrefName),M=meta.getElemAttr(e,meta.options.attrClickName),k=meta.getElemAttr(e,meta.options.attrClassName),w=0;w<t.length;w++){var S=document.createElement("li");k&&k.length>0&&S.classList.add(k);var j=meta.formatValue(e,t[w][L]);if(H&&H.length>0){b=document.createElement("a"),x=document.createTextNode(j);b.appendChild(x),M&&M.length>0&&b.setAttribute("onclick",M.replace(meta.options.indexName,t[w][a])),b.href=H.replace(meta.options.indexName,t[w][a]),S.appendChild(b)}else S.appendChild(document.createTextNode(j)),M&&M.length>0&&S.setAttribute("onclick",M.replace(meta.options.indexName,t[w][a]));t[w][a]&&S.setAttribute("id",t[w][a]),e.appendChild(S)}}},populate:function(e){for(var t=meta.options.attrArrayName,a=this.selectAll("["+t+"]"),n=0;n<a.length;n++){var r=e[a[n].getAttribute(t)]?e[a[n].getAttribute(t)]:e;meta.fill(a[n],r)}},bind:function(e){meta.populate(e),meta.paint(e)},load:function(e){var t=e.success,a=e.elem,n={method:"GET",url:e.url};this.extend(n,e),n.success=function(e,r,i){n.loadType==meta.loadTypesEnum.BeforeBeginAppend?a.outerHTML=e+a.outerHTML:n.loadType==meta.loadTypesEnum.AfterBeginAppend?a.innerHTML=e+a.innerHTML:n.loadType==meta.loadTypesEnum.BeforeEndAppend?a.innerHTML=a.innerHTML+e:n.loadType==meta.loadTypesEnum.AfterEndAppend?a.innerHTML=a.outerHTML+e:a.innerHTML=e,t&&t(e,r,i)},this.ajax(n)},loadHeader:function(e){var t={elem:document.body,loadType:meta.loadTypesEnum.AfterBeginAppend};this.extend(t,e),this.load(t)},loadFooter:function(e){var t={elem:document.body,loadType:meta.loadTypesEnum.BeforeEndAppend};this.extend(t,e),this.load(t)},filter:function(e,t,a,n){for(var r=[],i=0;i<e.length;i++)if(e[i][t]==a){if(n)return e[i];r.push(e[i])}return r},getUrlParam:function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null},getElemAttr:function(e,t){try{return e.getAttribute(t)}catch(e){}return""},unique:function(){return(new Date).getTime()},extend:function(e,t){$.extend(e,t)},ajax:function(e){$.ajax(e)},ready:function(e){var t=document.readyState;"interactive"===t||"complete"===t?e():setTimeout(function(){meta.ready(e)},100)},select:function(e){return document.getElementById(e)},selectAll:function(e,t){return t||(t=document),document.querySelectorAll(e)}};